#INFO: **** input file is /burg/ccce/users/eav2136/projects/core_level_spectroscopy/01_peommp2_cbe/meanfield.py ****
#!/usr/bin/env python
import json
from pyscf.pbc import gto, scf
from pyscf.pbc.tools import lattice, pyscf_ase
from pyscf.pbc.scf import chkfile
from fileutils import load, dump
import sys

material = load("data/{}".format(sys.argv[1]))
# Create Cell
cell = gto.Cell()
ase_atom = lattice.get_ase_atom(material["formula"])
cell.atom = pyscf_ase.ase_atoms_to_pyscf(ase_atom)
cell.a = ase_atom.cell[:]
cell.unit = "B"
cell.basis = material["basis"]
cell.exp_to_discard = material["exp_to_discard"]
cell.verbose = 7
cell.build()

# Mean Field
kdensity = material["kdensity"]
kmesh = [kdensity, kdensity, kdensity]
kpts = cell.make_kpts(kmesh, scaled_center=material["vb_scaled_center"])
mymf = scf.KRHF(cell, kpts=kpts, exxdiv="ewald")
mymf.chkfile = "data/{}".format(material["chk"])
mymf = mymf.density_fit()
mymf.with_df._cderi_to_save = "data/{}".format(material["cderi"])
ekrhf = mymf.kernel()
convergence = mymf.converged
mymf_data = dict([("ekrhf", float(ekrhf)),
                  ("convergence", bool(convergence))])
dump(mymf_data, "data/{}".format(material["ekrhf"]))
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='g146', release='4.18.0-193.el8.x86_64', version='#1 SMP Fri Mar 27 14:35:58 UTC 2020', machine='x86_64')  Threads 32
Python 3.10.12 (main, Jul 29 2023, 11:27:27) [GCC 13.2.0]
numpy 1.25.1  scipy 1.10.1
Date: Mon Jan 29 13:30:06 2024
PySCF version 2.0.1
PySCF path  /burg/berkelbach/users/eav2136/builds/pyscf/projected-cvs/pyscf
GIT ORIG_HEAD 0bfbc692adf3ea63b8a509210433219cd1c472a2
GIT HEAD (branch projected-cvs) e14caaa2dddc538b9be2d86f01e5b456fc92da36

[ENV] PYSCF_TMPDIR /burg/ccce/users/eav2136/projects/core_level_spectroscopy/01_peommp2_cbe/tmp
[ENV] PYSCF_MAX_MEMORY 700000
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 700000
[CONFIG] TMPDIR = /burg/ccce/users/eav2136/projects/core_level_spectroscopy/01_peommp2_cbe/tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = None
[INPUT] verbose = 7
[INPUT] max_memory = 700000 
[INPUT] num. atoms = 4
[INPUT] num. electrons = 40
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = B
[INPUT]  1 Al     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr
[INPUT]  2 N      0.000000000000   1.795559208370   0.597603705456 AA    0.000000000000   3.393115144260   1.129307334337 Bohr
[INPUT]  3 Al     0.000000000000   1.795559208370   2.489999821373 AA    0.000000000000   3.393115144260   4.705417712610 Bohr
[INPUT]  4 N      0.000000000000   0.000000000000   3.087603526828 AA    0.000000000000   0.000000000000   5.834725046947 Bohr
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Al
[INPUT] 0    0    [13   /3   ]  205500            6.78836e-05 -1.76377e-05 4.07315e-06
                                30780             0.000527149 -0.000137195 3.16566e-05
                                7006              0.00276203 -0.00071891 0.000166116
                                1985              0.0114728 -0.00301146 0.000694992
                                649.1             0.0398188 -0.0106014 0.00245511
                                235               0.11504 -0.0321345 0.00744598
                                91.62             0.260887 -0.0803156 0.0188253
                                37.67             0.396386 -0.156794 0.0372772
                                15.91             0.284597 -0.168376 0.0419496
                                5.85              0.0444583 0.126879 -0.0354375
                                2.542             -0.00489838 0.561494 -0.175132
                                1.057             0.00261253 0.436613 -0.276203
                                0.1455            0.000722068 -0.0114563 0.652809
[INPUT] 0    0    [1    /1   ]  0.2931               1
[INPUT] 0    0    [1    /1   ]  0.0565               1
[INPUT] 1    0    [7    /2   ]  444.4             0.00162786 -0.000286341
                                105.1             0.0130687 -0.00242308
                                33.47             0.0612341 -0.0108658
                                12.33             0.18787 -0.0364307
                                4.869             0.360452 -0.0641074
                                1.961             0.408454 -0.0972239
                                0.1888            0.00976514 0.503448
[INPUT] 1    0    [1    /1   ]  0.7834               1
[INPUT] 1    0    [1    /1   ]  0.05557              1
[INPUT] 2    0    [1    /1   ]  0.109                1
[INPUT] 2    0    [1    /1   ]  0.333                1
[INPUT] 3    0    [1    /1   ]  0.244                1
[INPUT] 0    0    [1    /1   ]  7.488                1
[INPUT] 0    0    [1    /1   ]  1.272                1
[INPUT] 1    0    [1    /1   ]  2.202                1
[INPUT] 1    0    [1    /1   ]  5.548                1
[INPUT] 2    0    [1    /1   ]  2.634                1
[INPUT] 2    0    [1    /1   ]  8.646                1
[INPUT] 3    0    [1    /1   ]  5.686                1
[INPUT] N
[INPUT] 0    0    [8    /2   ]  11420             0.000523 -0.000115
                                1712              0.004045 -0.000895
                                389.3             0.020775 -0.004624
                                110               0.080727 -0.018528
                                35.57             0.233074 -0.057339
                                12.54             0.433501 -0.132076
                                4.644             0.347472 -0.17251
                                0.5118            -0.008508 0.599944
[INPUT] 0    0    [1    /1   ]  1.293                1
[INPUT] 0    0    [1    /1   ]  0.1787               1
[INPUT] 1    0    [3    /1   ]  26.63             0.01467
                                5.948             0.091764
                                1.742             0.298683
[INPUT] 1    0    [1    /1   ]  0.555                1
[INPUT] 1    0    [1    /1   ]  0.1725               1
[INPUT] 2    0    [1    /1   ]  1.654                1
[INPUT] 2    0    [1    /1   ]  0.469                1
[INPUT] 3    0    [1    /1   ]  1.093                1
[INPUT] 0    0    [1    /1   ]  5.952                1
[INPUT] 0    0    [1    /1   ]  16.201               1
[INPUT] 1    0    [1    /1   ]  11.871               1
[INPUT] 1    0    [1    /1   ]  44.849               1
[INPUT] 2    0    [1    /1   ]  14.2                 1

Ewald components = 1.30435514859409e-35, -627.49757153652, 488.979720419325
nuclear repulsion = -138.517851117195
number of shells = 60
number of NR pGTOs = 278
number of NR cGTOs = 204
basis = ccpcvtz
ecp = {}
bas 0, expnt(s) = [2.055e+05 3.078e+04 7.006e+03 1.985e+03 6.491e+02 2.350e+02 9.162e+01
 3.767e+01 1.591e+01 5.850e+00 2.542e+00 1.057e+00 1.455e-01]
bas 1, expnt(s) = [0.2931]
bas 2, expnt(s) = [0.0565]
bas 3, expnt(s) = [4.444e+02 1.051e+02 3.347e+01 1.233e+01 4.869e+00 1.961e+00 1.888e-01]
bas 4, expnt(s) = [0.7834]
bas 5, expnt(s) = [0.05557]
bas 6, expnt(s) = [0.109]
bas 7, expnt(s) = [0.333]
bas 8, expnt(s) = [0.244]
bas 9, expnt(s) = [7.488]
bas 10, expnt(s) = [1.272]
bas 11, expnt(s) = [2.202]
bas 12, expnt(s) = [5.548]
bas 13, expnt(s) = [2.634]
bas 14, expnt(s) = [8.646]
bas 15, expnt(s) = [5.686]
bas 16, expnt(s) = [1.142e+04 1.712e+03 3.893e+02 1.100e+02 3.557e+01 1.254e+01 4.644e+00
 5.118e-01]
bas 17, expnt(s) = [1.293]
bas 18, expnt(s) = [0.1787]
bas 19, expnt(s) = [26.63   5.948  1.742]
bas 20, expnt(s) = [0.555]
bas 21, expnt(s) = [0.1725]
bas 22, expnt(s) = [1.654]
bas 23, expnt(s) = [0.469]
bas 24, expnt(s) = [1.093]
bas 25, expnt(s) = [5.952]
bas 26, expnt(s) = [16.201]
bas 27, expnt(s) = [11.871]
bas 28, expnt(s) = [44.849]
bas 29, expnt(s) = [14.2]
bas 30, expnt(s) = [2.055e+05 3.078e+04 7.006e+03 1.985e+03 6.491e+02 2.350e+02 9.162e+01
 3.767e+01 1.591e+01 5.850e+00 2.542e+00 1.057e+00 1.455e-01]
bas 31, expnt(s) = [0.2931]
bas 32, expnt(s) = [0.0565]
bas 33, expnt(s) = [4.444e+02 1.051e+02 3.347e+01 1.233e+01 4.869e+00 1.961e+00 1.888e-01]
bas 34, expnt(s) = [0.7834]
bas 35, expnt(s) = [0.05557]
bas 36, expnt(s) = [0.109]
bas 37, expnt(s) = [0.333]
bas 38, expnt(s) = [0.244]
bas 39, expnt(s) = [7.488]
bas 40, expnt(s) = [1.272]
bas 41, expnt(s) = [2.202]
bas 42, expnt(s) = [5.548]
bas 43, expnt(s) = [2.634]
bas 44, expnt(s) = [8.646]
bas 45, expnt(s) = [5.686]
bas 46, expnt(s) = [1.142e+04 1.712e+03 3.893e+02 1.100e+02 3.557e+01 1.254e+01 4.644e+00
 5.118e-01]
bas 47, expnt(s) = [1.293]
bas 48, expnt(s) = [0.1787]
bas 49, expnt(s) = [26.63   5.948  1.742]
bas 50, expnt(s) = [0.555]
bas 51, expnt(s) = [0.1725]
bas 52, expnt(s) = [1.654]
bas 53, expnt(s) = [0.469]
bas 54, expnt(s) = [1.093]
bas 55, expnt(s) = [5.952]
bas 56, expnt(s) = [16.201]
bas 57, expnt(s) = [11.871]
bas 58, expnt(s) = [44.849]
bas 59, expnt(s) = [14.2]
CPU time:         1.34
lattice vectors  a1 [5.877047826, 0.000000000, 0.000000000]
                 a2 [-2.938523913, 5.089672716, 0.000000000]
                 a3 [0.000000000, 0.000000000, 9.410835425]
dimension = 3
low_dim_ft_type = None
Cell volume = 281.499
rcut = 32.79019015615983 (nimgs = [7 7 4])
lattice sum = 1229 cells
precision = 1e-08
pseudo = None
ke_cutoff = 433261.4263657037
    = [1509 1509 2789] mesh (6350778909 PWs)


******** <class 'pyscf.pbc.scf.khf.KRHF'> ********
method = KRHF-KSCF-RHF-SCF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-07
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = data/aln_ccpcvtz_k3_N_1s_nvir_act39.chk
max_memory 700000 MB (current use 139 MB)


******** PBC SCF flags ********
N kpts = 27
kpts = [[0.         0.         0.        ]
 [0.         0.         0.22255145]
 [0.         0.         0.44510291]
 [0.         0.41149897 0.        ]
 [0.         0.41149897 0.22255145]
 [0.         0.41149897 0.44510291]
 [0.         0.82299795 0.        ]
 [0.         0.82299795 0.22255145]
 [0.         0.82299795 0.44510291]
 [0.35636857 0.20574949 0.        ]
 [0.35636857 0.20574949 0.22255145]
 [0.35636857 0.20574949 0.44510291]
 [0.35636857 0.61724846 0.        ]
 [0.35636857 0.61724846 0.22255145]
 [0.35636857 0.61724846 0.44510291]
 [0.35636857 1.02874744 0.        ]
 [0.35636857 1.02874744 0.22255145]
 [0.35636857 1.02874744 0.44510291]
 [0.71273713 0.41149897 0.        ]
 [0.71273713 0.41149897 0.22255145]
 [0.71273713 0.41149897 0.44510291]
 [0.71273713 0.82299795 0.        ]
 [0.71273713 0.82299795 0.22255145]
 [0.71273713 0.82299795 0.44510291]
 [0.71273713 1.23449692 0.        ]
 [0.71273713 1.23449692 0.22255145]
 [0.71273713 1.23449692 0.44510291]]
Exchange divergence treatment (exxdiv) = ewald
Monkhorst pack size [3 3 3] ew_eta 0.8844880366313383 ew_cut 7.945196698079207
Ewald components = 7.43877040383099e-109, -0.499283113992858, 0.434708743263287
    madelung (= occupied orbital energy shift) = 0.12914874145914124
    Total energy shift due to Ewald probe charge = -1/2 * Nelec*madelung = -2.58297482918
DF object = <pyscf.pbc.df.df.GDF object at 0x155535b92560>
Set gradient conv threshold to 0.000316228
Big error detected in the electron number of initial guess density matrix (Ne/cell = 39.9963)!
  This can cause huge error in Fock matrix and lead to instability in SCF for low-dimensional systems.
  DM is normalized wrt the number of electrons 40.0
    CPU time for vnuc pass1: analytic int   3601.80 sec, wall time    113.93 sec
    CPU time for contracting Vnuc [0:896]    298.06 sec, wall time     10.09 sec
    CPU time for contracting Vnuc    298.06 sec, wall time     10.09 sec
    CPU time for get_nuc   3900.97 sec, wall time    124.06 sec


******** <class 'pyscf.pbc.df.df.GDF'> ********
mesh = [9, 9, 15] (1215 PWs)
auxbasis = None
eta = 0.2
exp_to_discard = None
_cderi_to_save = data/aln_ccpcvtz_k3_N_1s_nvir_act39_cderi.h5
len(kpts) = 27
    kpts = [[0.         0.         0.        ]
 [0.         0.         0.22255145]
 [0.         0.         0.44510291]
 [0.         0.41149897 0.        ]
 [0.         0.41149897 0.22255145]
 [0.         0.41149897 0.44510291]
 [0.         0.82299795 0.        ]
 [0.         0.82299795 0.22255145]
 [0.         0.82299795 0.44510291]
 [0.35636857 0.20574949 0.        ]
 [0.35636857 0.20574949 0.22255145]
 [0.35636857 0.20574949 0.44510291]
 [0.35636857 0.61724846 0.        ]
 [0.35636857 0.61724846 0.22255145]
 [0.35636857 0.61724846 0.44510291]
 [0.35636857 1.02874744 0.        ]
 [0.35636857 1.02874744 0.22255145]
 [0.35636857 1.02874744 0.44510291]
 [0.71273713 0.41149897 0.        ]
 [0.71273713 0.41149897 0.22255145]
 [0.71273713 0.41149897 0.44510291]
 [0.71273713 0.82299795 0.        ]
 [0.71273713 0.82299795 0.22255145]
 [0.71273713 0.82299795 0.44510291]
 [0.71273713 1.23449692 0.        ]
 [0.71273713 1.23449692 0.22255145]
 [0.71273713 1.23449692 0.44510291]]
Even tempered Gaussians are generated as DF auxbasis for  Al N
  ETB auxbasis for Al  [[0, [7405.568, 1]], [0, [3702.784, 1]], [0, [1851.392, 1]], [0, [925.696, 1]], [0, [462.848, 1]], [0, [231.424, 1]], [0, [115.712, 1]], [0, [57.856, 1]], [0, [28.928, 1]], [0, [14.464, 1]], [0, [7.232, 1]], [0, [3.616, 1]], [0, [1.808, 1]], [0, [0.904, 1]], [0, [0.452, 1]], [0, [0.226, 1]], [0, [0.113, 1]], [1, [1836.0916571679966, 1]], [1, [918.0458285839983, 1]], [1, [459.02291429199914, 1]], [1, [229.51145714599957, 1]], [1, [114.75572857299979, 1]], [1, [57.37786428649989, 1]], [1, [28.688932143249946, 1]], [1, [14.344466071624973, 1]], [1, [7.172233035812487, 1]], [1, [3.5861165179062433, 1]], [1, [1.7930582589531217, 1]], [1, [0.8965291294765608, 1]], [1, [0.4482645647382804, 1]], [1, [0.2241322823691402, 1]], [1, [0.1120661411845701, 1]], [2, [455.22944, 1]], [2, [227.61472, 1]], [2, [113.80736, 1]], [2, [56.90368, 1]], [2, [28.45184, 1]], [2, [14.22592, 1]], [2, [7.11296, 1]], [2, [3.55648, 1]], [2, [1.77824, 1]], [2, [0.88912, 1]], [2, [0.44456, 1]], [2, [0.22228, 1]], [2, [0.11114, 1]], [3, [79.69542739003286, 1]], [3, [39.84771369501643, 1]], [3, [19.923856847508215, 1]], [3, [9.961928423754108, 1]], [3, [4.980964211877054, 1]], [3, [2.490482105938527, 1]], [3, [1.2452410529692635, 1]], [3, [0.6226205264846317, 1]], [3, [0.31131026324231587, 1]], [3, [0.15565513162115793, 1]], [4, [13.952, 1]], [4, [6.976, 1]], [4, [3.488, 1]], [4, [1.744, 1]], [4, [0.872, 1]], [4, [0.436, 1]], [4, [0.218, 1]]]
  ETB auxbasis for N  [[0, [2927.8208, 1]], [0, [1463.9104, 1]], [0, [731.9552, 1]], [0, [365.9776, 1]], [0, [182.9888, 1]], [0, [91.4944, 1]], [0, [45.7472, 1]], [0, [22.8736, 1]], [0, [11.4368, 1]], [0, [5.7184, 1]], [0, [2.8592, 1]], [0, [1.4296, 1]], [0, [0.7148, 1]], [0, [0.3574, 1]], [1, [359.572755541907, 1]], [1, [179.7863777709535, 1]], [1, [89.89318888547675, 1]], [1, [44.94659444273837, 1]], [1, [22.473297221369187, 1]], [1, [11.236648610684593, 1]], [1, [5.618324305342297, 1]], [1, [2.8091621526711483, 1]], [1, [1.4045810763355742, 1]], [1, [0.7022905381677871, 1]], [1, [0.35114526908389354, 1]], [2, [176.64, 1]], [2, [88.32, 1]], [2, [44.16, 1]], [2, [22.08, 1]], [2, [11.04, 1]], [2, [5.52, 1]], [2, [2.76, 1]], [2, [1.38, 1]], [2, [0.69, 1]], [2, [0.345, 1]], [3, [36.40750691821674, 1]], [3, [18.20375345910837, 1]], [3, [9.101876729554185, 1]], [3, [4.5509383647770925, 1]], [3, [2.2754691823885462, 1]], [3, [1.1377345911942731, 1]], [3, [0.5688672955971366, 1]], [4, [15.008, 1]], [4, [7.504, 1]], [4, [3.752, 1]], [4, [1.876, 1]], [4, [0.938, 1]]]
num shells = 218, num cGTOs = 902
Drop 0 primitive fitting functions
make aux basis, num shells = 218, num cGTOs = 902
auxcell.rcut 17.24916021658648
make compensating basis, num shells = 20, num cGTOs = 100
chgcell.rcut 11.482117703874595
